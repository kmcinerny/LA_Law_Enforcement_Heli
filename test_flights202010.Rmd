---
title: "test_202010flights"
author: '605194735'
date: "2/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, include=FALSE}
# loading packages I might need
library(plyr)
library(tidyverse)
library(ggplot2)
library(mosaic)
library(car)
library(gmodels)
library(readxl)
library(lubridate) #to separate date/time
library(plotly) #interactive graphics
library(ggmap)
```


```{r data}
# loading dataset

flights202010 <- read_csv("/Users/katemcinerny/Documents/UCLA/Carceral_ecologies/heli_data/data/csv/flights10.20.csv")

```

# Filter out unwanted fields

```{r new dataset}
# cleaning dataset by removing columns

new.flights10.20 <- subset(flights202010, select= -c(comment, success, cost, flights.aircraftModeS, flights.callsign, flights.depAirportIata, flights.arrAirportIata, flights.updated, flights.source, flights.positions.source, flights.positions.squawkCode, flights.squawkCode, flights.scheduledDeparture, flights.aircraftTypeDescription, flights.estimatedArrival))
# View(new.flights202010)

#export
#write.csv(new.flights202010, file = "new.flights202010")
```

# Unique states from which helicopters departed

```{r unique dep states}
# unique(new.flights202010$flights.depAirportState)

new.flights10.20 %>% count(flights.depAirportState)
```
Will have to recode CA--> also maybe a way to geocode so that missing cities can be filled in. or automatically fill in these details based on airport.

# Recode States
```{r recode states}

new.flights10.20$flights.depAirportState <- recode(new.flights10.20$flights.depAirportState, "'CALIFORNIA'= 'California'")
```


# Unique cities from which helicopters departed

```{r unique dep cities}
# unique(new.flights202010$flights.depAirportCity)

new.flights10.20 %>% count(flights.depAirportCity)
```


# Summary Stats

```{r summary altitude}
favstats(new.flights10.20$flights.positions.altitude)
```

Thoughts: the min altitude of 250 ft is very low-- even lower than the departing airport altitude of 550 feet.
I'm curious: Is there a way to graphically see the path of how altitudes change? Or mainly just map it? Curious whether the lower altitudes are concentrated in takeoff/landing or if they hover over certain neighborhoodsâ€¦

Is there a limit on how high or low helicopters should fly? How does the median of 850 ft impact noise levels, compared to min/ max?

Which law enforcement agency's helicopters are flying the lowest? (I hypothesize sherrifs, but who knows)

Then later on.... Want to look at where in the county they fly the lowest vs. highest.

Also, what should I do about missing values?
Is the max a true max or is it an outlier that I should exclude?

```{r summary speed}
favstats(new.flights10.20$flights.positions.groundSpeed)

```

Identifying outliers


## Change timezone

```{r UTC to PST}

y <- ymd_hms(new.flights10.20$flights.positions.timestamp)

new.flights10.20$flights.positions.PSTtimestamp <- with_tz(y)

View(new.flights10.20)
```


## Separate date-time-hour

```{r separate date-time-hour}
d <- as.POSIXct(new.flights10.20$flights.positions.PSTtimestamp, format="%Y-%m-%d %H:%M:%S")
new.flights10.20$flights.positions.date_km <- format(d, format="%Y-%m-%d")
new.flights10.20$flights.positions.time_km <- format(d, format="%H:%M:%S")
new.flights10.20$flights.positions.hour_km <- format(d, format="%H")
```


```{r}
#library(tidyverse)
#lat_long <- df %>%
 # mutate(loc = revgeocode(c(flights.positions.latitude, #flights.positions.longitude)))

```



```{r reverse_geocode}

#x <- revgeocode(flights.positions.latitude flights.positions.longitude)

```


## Graph altitude over time & group by the call sign

```{r altitude over time}
p <- ggplot(data=new.flights10.20, aes(x=flights.positions.PSTtimestamp, y=flights.positions.altitude, color=flights.aircraftRegistration)) + geom_line() 
ggplotly(p)
```


## Subset of aircrafts
```{r subset altitude over time}
p <- ggplot(subset(new.flights10.20, flights.aircraftRegistration %in% c("N108DJ", "N108PP", "N110LA")), aes(x=flights.positions.PSTtimestamp, y=flights.positions.altitude, color=flights.aircraftRegistration)) + geom_line() 
ggplotly(p)

```



## Plot Count of Unique Helicopters in the Air during each hour of the day throughout the month of October, 2020

```{r plot heli count}
# how many times each unique aircraft was in the air during each hour

myplot_df <- unique(new.flights10.20[c("flights.aircraftRegistration", "flights.positions.hour_km")])

p <- ggplot(data=myplot_df, aes(x=flights.positions.hour_km, color=flights.aircraftRegistration)) + geom_bar() 

ggplotly(p)


```
confirm timezone because it seems weird that very few aircrafts would ever be out at noon at all during the month
& why does hour say NA in the hover?

## Plot aggregate times each helicopter flew during different hours of the day throughout the month of October, 2020

```{r plot heli time}
p <- ggplot(data=new.flights10.20, aes(x=flights.positions.hour_km, color=flights.aircraftRegistration)) + geom_bar() 
ggplotly(p)
```

give me first & last and difference
took off, landed

only want one of several positions within that hour




## Average flight duration

```{r avg flight duration}

#avg (calculated landing-calculated takeoff)

# interested in total flight hours (and then later, flight hours spent in x axis code)
```

